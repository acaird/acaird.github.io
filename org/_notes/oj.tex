% Created 2013-05-14 Tue 21:30
\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{fixltx2e}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{float}
\usepackage{wrapfig}
\usepackage{soul}
\usepackage{textcomp}
\usepackage{marvosym}
\usepackage{wasysym}
\usepackage{latexsym}
\usepackage{amssymb}
\usepackage{hyperref}
\tolerance=1000
\providecommand{\alert}[1]{\textbf{#1}}

\title{oj.org}
\author{Andrew Caird}
\date{2013-05-14 Tue}
\hypersetup{
  pdfkeywords={},
  pdfsubject={},
  pdfcreator={Emacs Org-mode version 7.9.4}}

\begin{document}

\maketitle

\setcounter{tocdepth}{3}
\tableofcontents
\vspace*{1cm}

\section{Introduction}
\label{sec-1}


\href{http://wiki.github.com/mojombo/jekyll}{Jekyll} is a static web site
generator written in Ruby. It can transform various text markups, using
a templating language, into static html. The resulting site can be
served by almost any web server without requiring additional components
such as php. Jekyll is the tool used to produce Github's pages.

This article discusses how to produce both a static site and a blog
using Jekyll and org. Rather than writing a markup processor for org
files, I have relied on org's html export features to generate files
that can be processed by Jekyll.

Org already has an excellent html export engine. However, it lacks built
in support for blogging. Using Jekyll also gives more control over the
final appearance of your site.

Publishing your site with org and Jekyll involves three steps:

\begin{enumerate}
\item write your page content using org.
\item use org to export your pages to html in the Jekyll project directory.
\item run Jekyll to convert your html pages exported from org into your
   final site.
\end{enumerate}

By default Jekyll produces its output in the \texttt{\_site} directory of
Jekyll's working directory. This is a self contained version of your
site, which can be deployed to your web server. The files in \texttt{\_site} are
completely self contained, so all you need to do is to copy them to your
web server. Methods include using ftp, rsync or a git post commit hook.
You can configure where Jekyll puts its published files in
\texttt{\_config.yml}.

Essentially, I am using org to produce everything between the \texttt{<body>}
tags on the page and Jekyll to produce the rest. Note that you can
easily embed html content in your org pages using the \texttt{+BEGIN\_HTML} tag.
\section{Install Jekyll}
\label{sec-2}


Installation is described at the
\href{http://github.com/mojombo/jekyll}{Jekyll} web site.
\section{Project Directory Structure}
\label{sec-3}


Jekyll expects a certain directory structure. In the example below my
Jekyll project is in a directory called \texttt{jekyll}. Blog posts are in
\texttt{\_posts} and the layout templates in \texttt{\_layouts}. The \texttt{\_includes}
directory is for files containing code you want to include in other
pages e.g. a header or sidebar.

The file \texttt{\_config.yml} is a YAML file that contains Jekyll's
configuration for the site.

In addition to the \texttt{\_posts} directory you can create other directories
to hold different non blog parts of your site.


\begin{verbatim}
'|myproject
'|   |org
'|      |_posts
'|      |-- 2009-11-26-my-first-post.org
'|   |index.org
'|   |jekyll
'|   -- _config.yml
'|   -- _layouts
'|      |-- default.html
'|      `-- post.html
'|   -- _posts
'|      |-- 2009-11-26-my-first-post.html
'|
'|   -- |_site
'|   -- |_includes
`    -- index.html
\end{verbatim}

You should setup the directory structure of your org files to mirror
that of the Jekyll project. Then when you export your org files as html
the files will end up in the correct place in your Jekyll project. I
usually place the directory containing my org files in the directory
about the Jekyll project directory to make sure that Jekyll doesn't
consider .org files to be part of its project.
\section{Configuring org html Export}
\label{sec-4}


The fundamentals of publishing html are described in the
\href{http://orgmode.org/worg/org-tutorials/org-publish-html-tutorial.html}{HTML publishing tutorial} on worg. I am assuming that you have a basic
working org publishing setup. By default org produces complete web
pages. However, as I am using Jekyll I am only really interested in the
section of the page between the \texttt{<body>} tags, as Jekyll produces the
rest. Most things in org are configurable and it's possible to tell org
to export only the bits of the page between the \texttt{<body>} tags. Here is
the relevant section of my \texttt{.emacs} file:


\begin{verbatim}
(setq org-publish-project-alist
      '(

  ("org-ianbarton"
          ;; Path to your org files.
          :base-directory "~/devel/ianbarton/org/"
          :base-extension "org"

          ;; Path to your Jekyll project.
          :publishing-directory "~/devel/ianbarton/jekyll/"
          :recursive t
          :publishing-function org-publish-org-to-html
          :headline-levels 4
          :html-extension "html"
          :body-only t ;; Only export section between <body> </body>
    )


    ("org-static-ian"
          :base-directory "~/devel/ianbarton/org/"
          :base-extension "css\\|js\\|png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf\\|php"
          :publishing-directory "~/devel/ianbarton/"
          :recursive t
          :publishing-function org-publish-attachment)

    ("ian" :components ("org-ianbarton" "org-static-ian"))

))
\end{verbatim}

To export my site I just run \texttt{C-c e X ian}.

You need to set the destination of your exported files to your Jekyll
project directory. Assuming you have set up your org directory structure
to mirror that of your Jekyll project everything should end up in the
correct place.
\section{Creating an org File to be Published with Jekyll}
\label{sec-5}


When you run Jekyll it processes the source files for your site and any
files with YAML Front Matter are subject to special processing. The
Front Matter is used to tell Jekyll how to format your page.

Bear in mind that Jekyll doesn't process your \texttt{.org} files, but the
\texttt{.html} files produced by exporting. So when writing an org file it
should be formatted in such a way that when exported it produces html
suitable for processing by Jekyll.

YAML Front Matter must be the first thing in the file, with no blank
lines above the Front Matter Section. A typical Front Matter Section
would look like:


\begin{verbatim}
---
layout: default
title: My Page Title.
---
\end{verbatim}

So you should ensure that any Front Matter directives come first in your
org file.

Note that the three hyphens \texttt{-{}-{}-} are part of the markup and are
required. The layout tag tells Jekyll which layout from its \texttt{\_layouts}
directory should be used to format your page. You can include any other
keys in the Front Matter section (e.g. \texttt{title:}), which you can use in
your page. See the Jekyll
\href{http://wiki.github.com/mojombo/jekyll/yaml-front-matter}{wiki} for
more details on Front Matter.

Below is a short extract from one of my org files showing my setup:


\begin{verbatim}
#+STARTUP: showall indent
#+STARTUP: hidestars
It was early January when six of us travelled up to ....
\end{verbatim}

The Front Matter section is wrapped in \texttt{\#+BEGIN\_HTML} so it is exported
literally to the final html file. You may need to upgrade your org
version as older versions produced two blank lines before the Front
Matter section when exported. You can define your own Front Matter keys
and use them within your generated page. In the above example I use the
``excerpt'' key to display ``teasers'' for a blog post.

Note that the current git version of org removes the first \texttt{-{}-{}-} if the
directory containing the file start with an underscore. The workaround
is to start your file with \texttt{-{}-{}-} in both the first two lines.

Carsten has also provided two hooks that are run after exporting is
complete, which can also be used to tidy up the output:


\begin{verbatim}
org-export-html-final-hook      (always)
org-publish-after-export-hook   (when going through org-publish)
\end{verbatim}

Once you have exported your org project to html it's simply a matter of
running jekyll to produce the final output. By default Jekyll puts its
output in the \texttt{\_site} directory of your project, but you can customize
this in your \texttt{\_config.yml} file.
\section{Blogging with Jekyll and Org}
\label{sec-6}


Jekyll has built-in support for blogging. Anything you place in the
\texttt{\_posts} directory of your Jekyll project is considered as a blog post.
However, the file names of your posts must adhere to the following
format:


\begin{verbatim}
yyyy-mm-dd-post_name.html
\end{verbatim}

To write a post just create a new file with the correct filename in your
\texttt{org/\_posts} directory. You may find that Yasnippet is useful for
inserting Front Matter and other directives in your org file. When you
have finished just run \texttt{C-c e X} project\_name to export your org
project as html and then run jekyll to generate your site.

You can use Jekyll's
\href{http://wiki.github.com/mojombo/jekyll/template-data}{template} markup
to decide how your blog posts are displayed. On the Jekyll
\href{http://wiki.github.com/mojombo/jekyll/sites}{sites} page there are
many sites with source listed, so you can study how other people use the
markup to create their blog. You can also view my site
\href{http://www.ian-barton.com}{http://www.ian-barton.com} and see a
snapshot of the source at
\href{http://github.com/geekinthesticks/ianbarton}{http://github.com/geekinthesticks/ianbarton}.

You can assign categories to your posts either by placing posts inside
folders like:


\begin{verbatim}
_posts/org/jekyll/howto.html
\end{verbatim}

This would assign your post to the \emph{org} and \emph{jekyll} categories.

or by using YAML markup in your org file:


\begin{verbatim}
categories:
    - org
    - linux
\end{verbatim}
\subsection{Showing Blog Posts on the Front Page}
\label{sec-6-1}


Most blogs show the latest posts on their front page. The example below
shows the title and an excerpt for the five latest posts:


\begin{verbatim}
<ul class="posts">
{% for post in site.posts limit: 5 %}
  <div class="post_info">
    <li>
            <a href="{{ post.url }}">{{ post.title }}</a>
            <span>({{ post.date | date:"%Y-%m-%d" }})</span>
    </li>
    </br> <em>{{ post.excerpt }} </em>
    </div>
  {% endfor %}
</ul>
\end{verbatim}
\subsection{Creating Archive Pages}
\label{sec-6-2}


You will probably only want to display a limited number of blog posts on
your front page. However, you will also want to make older pages
available. You can create a simple list of all blog posts using the
following markup:


\begin{verbatim}
<ul>
  {% for post in site.posts %}
  <li>
    <a href="{{ post.url }}" title="{{ post.title }}">
      <span class="date">
        <span class="day">{{ post.date | date: '%d' }}</span>
        <span class="month"><abbr>{{ post.date | date: '%b' }}</abbr></span>
        <span class="year">{{ post.date | date: '%Y' }}</span>
      </span>
      <span class="title">{{ post.title }}</span>
    </a>
  </li>
  {% endfor %}
</ul>
\end{verbatim}
\section{Inserting Image}
\label{sec-7}


You will probably want to insert some images into your blog posts. I use
the following method:


\begin{verbatim}
<img src ="/images/skiddaw.jpg"
alt="John and Ella on Skiddaw" align="left" width="300" height="250"
title="John and Ella on Skiddaw" class="img"</img>
\end{verbatim}

Note that the class attribute refers to the class used to style the
image tag in your css. My css contains:


\begin{verbatim}
img {
    margin: 15px;
    border: 1px solid blue;
}
\end{verbatim}

Note that if you wish to have some space between your image and the
text, using padding in your css doesn't seem to work. I use margin,
which gives the same effect.

Whilst this works, it won't display captions for your images.
Unfortunately, after years of development xhtml doesn't seem to provide
an easy way to display image captions. I decided to use the method
described \href{http://www.w3.org/Style/Examples/007/figures}{here}. An
example from of floating a picture to the right of the text is shown
below.

In your \texttt{.org} file use the following html to embed the picture:


\begin{verbatim}
<div class="photofloatr">
  <p><img src="myphoto.jpg" width="300"
    height="150" alt="My Mug Shot"></p>
  <p>A photo of me</p>
</div>
\end{verbatim}

Now you need to add some information to your style sheet:


\begin{verbatim}
div.photofloatr {
    float: right;
    border: thin silver solid;
    margin: 0.5em;
    padding: 0.5em;
}

div.photofloatr p {
  text-align: center;
  font-style: italic;
  font-size: smaller;
  text-indent: 0;
}
\end{verbatim}

A third method, which I haven't tried myself, is to use the \emph{jQuery EXIF} plugin to extract the caption from the image EXIF data and use
Javascript to display it. See
\href{http://www.nihilogic.dk/labs/exif/}{here} for more details.
\section{Using Text Markup in Front Matte}
\label{sec-8}


By default text in the Front Matter part of your file isn't processed by
Jekyll's markup engine. However, you can use the Textilize filter to
convert your Front Matter string into HTML, formatted using textile
markup.

I use this to format my page excerpts, which I include in my org files
Front Matter markup. So in my sites index.html I have:


\begin{verbatim}
<li>
  <a href="{{ post.url }}">{{ post.title }}</a>
  <span>({{ post.date | date:"%Y-%m-%d" }})</span>
</li>
</br>
<em>{{ post.excerpt | textilize}}</em>
\end{verbatim}

This lets me use textile markup in my page excerpts, which are defined
in my page's YAML Front Matter section.
\section{Version Control with Jekyl}
\label{sec-9}


Jekyll is amenable to using version control systems. If you follow my
suggested directory structure you can create a git repo to your top
level directory. You can then create a post-commit script that runs the
org html export and then runs Jekyll to generate your site.
\section{HappyBlogger's Jekyll Modification}
\label{sec-10}


Bjørn Arild Mæland has created some modifications to Jekyll to provide
some pre-processing to org files to allow for better integration with
Jekyll. You can find his code on
\href{http://github.com/bmaland/happyblogger}{github}.
\section{Another example of Org-mode/Jekyll usage}
\label{sec-11}


The on-line documentation for
\href{file://.../org-contrib/babel/index.html}{Org-babel} development is published
on \href{http://github.com}{github} which uses jekyll. The following code
is used to publish one blog post for every subheading of the first to
top-level headings of a org file which tracks Org-babel development. The
results can be seen \href{http://eschulte.github.com/babel-dev/}{here}, and
the code used to create this site is available
\href{http://github.com/eschulte/babel-dev/}{here}.


\begin{verbatim}
(save-excursion
  ;; map over all tasks entries
  (let ((dev-file (expand-file-name
                   "development.org"
                   (file-name-directory (buffer-file-name))))
        (posts-dir (expand-file-name
                    "_posts"
                    (file-name-directory (buffer-file-name))))
        (yaml-front-matter '(("layout" . "default"))))
    ;; go through both the tasks and bugs
    (mapc
     (lambda (top-level)
       (find-file dev-file)
       (goto-char (point-min))
       (outline-next-visible-heading 1)
       (org-map-tree
        (lambda ()
          (let* ((props (org-entry-properties))
                 (todo (cdr (assoc "TODO" props)))
                 (time (cdr (assoc "TIMESTAMP_IA" props))))
            ;; each task with a state and timestamp can be exported as a
            ;; jekyll blog post
            (when (and todo time)
              (message "time=%s" time)
              (let* ((heading (org-get-heading))
                     (title (replace-regexp-in-string
                             "[:=\(\)\?]" ""
                             (replace-regexp-in-string
                              "[ \t]" "-" heading)))
                     (str-time (and (string-match "\\([[:digit:]\-]+\\) " time)
                                    (match-string 1 time)))
                     (to-file (format "%s-%s.html" str-time title))
                     (org-buffer (current-buffer))
                     (yaml-front-matter (cons (cons "title" heading) yaml-front-matter))
                     html)
                (org-narrow-to-subtree)
                (setq html (org-export-as-html nil nil nil 'string t nil))
                (set-buffer org-buffer) (widen)
                (with-temp-file (expand-file-name to-file posts-dir)
                  (when yaml-front-matter
                    (insert "---\n")
                    (mapc (lambda (pair) (insert (format "%s: %s\n" (car pair) (cdr pair))))
                          yaml-front-matter)
                    (insert "---\n\n"))
                  (insert html))
                (get-buffer org-buffer)))))))
     '(1 2))))
\end{verbatim}
\section{Other Blog Solutions for org}
\label{sec-12}
\subsection{Blorgit}
\label{sec-12-1}


\href{http://orgmode.org/worg/blorgit.html}{Blorgit} uses org mode for
markup and runs on the Sinatra mini framework. It is amenable to using
git for posting and maintenance.
\subsection{ikiwiki}
\label{sec-12-2}


\href{http://ikiwiki.info/}{ikiwiki} is a web site compiler written in
Perl. In many ways it is similar to Jekyll, but has closer integration
with version control systems. It supports blogging and has many plugins.

There is an org mode plugin by
\href{http://www.golden-gryphon.com/blog/manoj/blog/2008/06/08/Using_org-mode_with_Ikiwiki/}{Manoj},
which lets you write your posts in org and converts them to html
suitable for processing by ikiwiki.

Documentation from the \href{http://orgmode.org/worg/}{http://orgmode.org/worg/} website (either in its
HTML format or in its Org format) is licensed under the
\href{http://www.gnu.org/copyleft/fdl.html}{GNU Free Documentation License version 1.3} or later. The code examples and css stylesheets are
licensed under the \href{http://www.gnu.org/licenses/gpl.html}{GNU General Public License v3} or later.

\end{document}
