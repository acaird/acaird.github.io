---
layout: post
title: Extracting Data from PDF Forms into CSV Files
tagline: PDF to Excel with a GUI! On Windows or MacOS!
categories: computers
tags: golang pdf forms csv excel sheets cross-platform macos windows
---

<p>
My friend has a cool job helping people <a href="https://www.washtenaw.org/CivicAlerts.aspx?AID=1483">stay out of jail in Washtenaw
County, Michigan, USA</a>.  That lofty mission, like so many these days,
is underpinned by the lowly PDF form.  I wanted to make her job easier
by automating the extraction of data from those forms into a summary
spreadsheet.
</p>

<p>
tl;dr: Everyone on the Internet is cool and lets you use their code
and you can put it all together to do other cool things.  This is no
exception, so big thanks to: <a href="https://github.com/gen2brain">Milan Nikolic</a> for the very nice <code>dlgs</code>
dialog box code; the <a href="https://github.com/pdfcpu/pdfcpu">PDF CPU</a> project for the PDF parsing code; and
<a href="https://github.com/sirupsen">Simon Eskildsen</a> for his very friendly <code>logrus</code> logging code.
</p>

<div id="outline-container-orgedd7158" class="outline-2">
<h2 id="orgedd7158">The first problem: Parsing PDF Form Data</h2>
<div class="outline-text-2" id="text-orgedd7158">
<p>
The <a href="https://github.com/pdfcpu/pdfcpu">PDF CPU</a> library does a very nice job of returning a map of form
element labels and the data that was entered into the form.  This is
done in the <code>parsePdfForm</code> routine.
</p>

<p>
One of the downsides of this approach is that the form element
labels as generated by Acrobat&rsquo;s conversion of input files (like
Word files) to PDF forms are, by default, randomly grabbed from the
surrounding context, so sometimes are not useful and can seemingly
be up to 99 characters long.  I use these as the CSV column
headings, so they can be sort of confusing and very annoying.  I
couldn&rsquo;t think of a better way to do this in the general case, so
this is what you get.  I did consider supporting a file that maps
between what&rsquo;s in the form and what you want as headings, or a GUI
that let&rsquo;s you rename the fields before writing the summary, but
that seemed like a lot of extra work for version 1.0.0, so skipped
it.
</p>
</div>
</div>

<div id="outline-container-orgd3235e0" class="outline-2">
<h2 id="orgd3235e0">The second problem: Not all of the PDF files are the same</h2>
<div class="outline-text-2" id="text-orgd3235e0">
<p>
It is possible that the PDF forms will change over time with added
fields, changed fields, removed fields, or just be altogether
different forms.  After parsing all of the PDF files in the target
directory, we have a set of form fields (the result of the &ldquo;first
problem&rdquo;).  What do we write as the summary?  Does the first file
read define the set of fields?  Is the set the intersection of them,
so only those fields that appear in all of the forms also appear in
the summary?  Is it the union of them, so every field that appears
in any form appears in the summary?  Is there some other
configuration read from a file or developed interactively via a GUI
that is used to define the fields in the summary?
</p>

<p>
The easiest thing is to keep the union of all of the fields.  This
can lead to weird output, though, and also requires that all of the
files are read and processed before the summary can begin to be
created.  For example, say you have two PDF Form files, one is to
order a hamburger and one is to order a book.  You could end up with
a summary file that looks like:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>

<colgroup>
<col  class="org-right" />
</colgroup>

<colgroup>
<col  class="org-left" />
</colgroup>

<colgroup>
<col  class="org-left" />
</colgroup>

<colgroup>
<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">File</th>
<th scope="col" class="org-right">Number of Patties</th>
<th scope="col" class="org-left">Wheat Bun</th>
<th scope="col" class="org-left">Title</th>
<th scope="col" class="org-left">Author</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">book.pdf</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">The TeX Book</td>
<td class="org-left">D. Knuth</td>
</tr>

<tr>
<td class="org-left">hburg.pdf</td>
<td class="org-right">2</td>
<td class="org-left">On</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">zbook.pdf</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">CDB!</td>
<td class="org-left">W. Steig</td>
</tr>
</tbody>
</table>


<p>
In order to make the headings, the program has to know all of the
form fields from all of the forms, then it has to go through each
set of data from each form and and fill in the table, not
compressing the data upwards, but keeping it aligned with the file
from which it came.  Annoying and error-prone, at least the way I
first did it.  This is done in the function <code>structData</code>.
</p>
</div>
</div>

<div id="outline-container-org898f37d" class="outline-2">
<h2 id="org898f37d">The third problem: Icons</h2>
<div class="outline-text-2" id="text-org898f37d">
<p>
I really wanted icons for the program, and bundling it all together
for either Windows or MacOS is purportedly possible.  I tried to do
this, but was only slightly successful (the MacOS App did get an
icon).  The details are in the <a href="https://github.com/acaird/pdfform2csv#building">Building</a> section of the <a href="https://github.com/acaird/pdfform2csv#readme">ReadMe</a> file.
</p>
</div>
</div>

<div id="outline-container-org3e7582c" class="outline-2">
<h2 id="org3e7582c">No problem: The results</h2>
<div class="outline-text-2" id="text-org3e7582c">
<p>
In a <a href="https://golang.org">Go</a> program of just over 300 lines and some extra support files,
I have a cross-platform, single file (well, sort of, for the Mac)
application that has a graphical interface to reading a directory
full of PDF Form files and writes to that same directory a CSV file
summarizing the data from the PDF files:
<a href="https://github.com/acaird/pdfform2csv">https://github.com/acaird/pdfform2csv</a>
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">MacOS</td>
<td class="org-left">Windows</td>
</tr>

<tr>
<td class="org-left"><img src="/assets/2021-05-24-ss-welcome-mac.png" alt="2021-05-24-ss-welcome-mac.png" /></td>
<td class="org-left"><img src="/assets/2021-05-24-ss-welcome-win.png" alt="2021-05-24-ss-welcome-win.png" /></td>
</tr>

<tr>
<td class="org-left"><img src="/assets/2021-05-24-ss-filedialog-mac.png" alt="2021-05-24-ss-filedialog-mac.png" /></td>
<td class="org-left"><img src="/assets/2021-05-24-ss-filedialog-win.png" alt="2021-05-24-ss-filedialog-win.png" /></td>
</tr>

<tr>
<td class="org-left"><img src="/assets/2021-05-24-ss-results-mac.png" alt="2021-05-24-ss-results-mac.png" /></td>
<td class="org-left"><img src="/assets/2021-05-24-ss-results-win.png" alt="2021-05-24-ss-results-win.png" /></td>
</tr>
</tbody>
</table>
</div>
</div>
